<!-- detail.html - Partial view for properties on each patient -->

{% extends "base.html" %}

{% block title %}Patient Detail{% endblock %}

{% block page_header %}
    </br></br>
    <div class="page-header">
        <h1>{{ patient.first_name }} {{ patient.last_name }}</h1>
    </div>
    <style type="text/css">
        p { overflow-wrap: break-word; word-wrap: break-word; }
    </style>
{% endblock %}


{% block content %}

    <script src="../static/js/vis.js"></script>
    <script src="../static/js/bigData.js"></script>
    <link href="../static/css/vis.css" rel="stylesheet" type="text/css" />

    <div id="visualization"></div>

    {# Populate the graph #}
    <script type="text/javascript">

        {# Receive data from server-side into client-side JS object. #}
        var data = {{ data | tojson }};
        var hr = {{ hrDaily | tojson }};


        // Convert to x-y format for Vis JS
        all = [];
        for (var key in data) {
            all.push({'x': key, 'y': data[key], group: 0});
        }
        var DATA = new Big(all);

        for (var key in hr) {
            all.push({'x': key, 'y': hr[key], group: 1});
        }

        var container = document.getElementById('visualization');
        // var dataset = new vis.DataSet(all);

        var groups = new vis.DataSet();
        groups.add({
            id: 0,
            content: "HR",
            options: {
                drawPoints: {
                    style: 'circle' // square, circle
                }
        }});

        groups.add({
            id: 1,
            content: "Average Resting HR",
            options: {
                drawPoints: {
                    style: 'square' // square, circle
                }
        }});


        var options = {
          start: "{{ start }}",
          end: "{{ end }}"
        };
        var graph2d = new vis.Graph2d(container, all, groups, options);
        console.log(all.length)

        graph2d.on('rangechanged', function(event) {
            var s = event['start'];
            var e = event['end'];
            console.log('Scaling down');
            var items = DATA.getRange(s.toString(), e.toString());
            graph2d.setItems(items);
            console.log('Scaled down to ', items.length);
        });


    </script>

    <div class="row">
        <div class="col-md-11">
            <h4><span class="label label-success">Resting Heart Rate Average:</span></h4><p>{{ resting }}</p>
        </div>
    </div>
{% endblock %}